@using TotalFireSafety.Models

<title>Inventory Report </title>
<link rel="stylesheet" href="~/css/sa-inventory-style.css">
<link rel="shortcut icon" type="image/icon" href="~/images/tfsti-logo-noname.png" />
<link rel="stylesheet"
      href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
<link rel="stylesheet" href="~/css/sa-dashboard-style.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>


<div class="">
    <main>
        <center>
                <div class="container">
                    <div class="d-flex justify-content-between">
                        <img src="~/images/tfsti-logo-inventory.png" style="width: 35%; height: 150px;">
                        <div class="mt-3">
                            <table cellspacing="0" cellpadding="0">
                                <tr>
                                    <td colspan="2">Name: @ViewBag.Name</td>
                                    <td colspan="2">Position: @ViewBag.Position</td>

                                </tr>
                                <tr>
                                    <td colspan="2">Employee ID: @ViewBag.Id</td>
                                    <td colspan="2">Date Printed: @DateTime.Now.ToString("MMMM dd, yyyy")</td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        Date Request: <div class="datepick-container">
                                            <span></span>

                                            <div class="date-grp">
                                                <input type="date" id="startDate">
                                                <label for=""> - </label>
                                                <input type="date" id="endDate">
                                            </div>

                                        </div>

                                    </td>

                                </tr>
                            </table>
                        </div>
                    </div>
                    <br><br>
                    <table id="myTable" class="myTable">
                        <thead>
                            <tr>
                                <td colspan="12" class="font-weight-bold text-center">INVENTORY STOCK REPORT</td>
                            </tr>
                            <tr style="background-color: rgb(255, 255, 0);" class="font-weight-bold">
                                <td class="font-weight-bold">Date Added <span></span></td>
                                <td class="font-weight-bold">Code</td>
                                <td class="font-weight-bold">Name</td>
                                <td class="font-weight-bold">Category</td>
                                <td class="font-weight-bold">Type</td>
                                <td class="font-weight-bold">Size</td>
                                <td class="font-weight-bold">Quantity</td>
                                <td class="font-weight-bold">Remarks</td>
                                <td class="font-weight-bold">Class</td>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <script src="@Url.Content("~/Scripts/reportinventory.js")"></script>

                </div>
            <script>
                const today = new Date().toISOString().split('T')[0];

                // Set the max attribute of the startDate input to today
                document.getElementById("startDate").max = today;

                // Set the max attribute of the endDate input to today
                document.getElementById("endDate").max = today;
            </script>

            <br>

            <!-- <script>
            const d = new Date();
            document.getElementById("demo").innerHTML = d.toDateString();
        </script> -->
        </center>

        <style media="print">
            .buttons1, .buttons2 {
                display: none;
            }
        </style>

        <div class="mt-5 d-flex justify-content-end mr-3" style="display: none;">
            <div class="d-flex justify-content-between">
                <button type="button" onclick="exportToPdf()" class="btn btn-primary btn-lg buttons1 ml-2">EXPORT</button>
                <button type="button" onclick="window.print();" class="btn btn-primary btn-lg buttons1 ml-2">PRINT</button>
                <button type="button" class="btn btn-outline-primary buttons2 ml-2"><a href="@Url.Action("InventoryReport", "Admin")" onclick="window.close(); return false;">CANCEL</a></button>
            </div>
        </div>


        <script>
            // Show the buttons when the page is loaded
            window.onload = function () {
                document.querySelector(".mt-5").style.display = "block";
            };

            // Hide the buttons when printing
            window.onbeforeprint = function () {
                document.querySelector(".mt-5").style.display = "none";
            };

            // Show the buttons after printing
            window.onafterprint = function () {
                document.querySelector(".mt-5").style.display = "block";
            };
        </script>


        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.16/jspdf.plugin.autotable.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
        <script>
            //function exportToPdf() {
            //    const element = document.querySelector('.container');
            //    const options = {
            //        margin: [0, 0, 0, 0],
            //        filename: 'Report.pdf',
            //        pdf: {
            //            format: 'letter',
            //            orientation: 'portrait',
            //        },
            //        html2canvas: { scale: getScaleFactor(element.offsetWidth, element.offsetHeight) },
            //        jsPDF: {
            //            unit: 'in',
            //            repeatTableHeader: true, // Repeat table header on every page
            //            addPageContent: function (data) {
            //                var rowCount = document.querySelectorAll('.myTable tbody tr').length;
            //                if (rowCount > 10) {
            //                    this.addPage();
            //                    rowCount = 0;
            //                }
            //                if (data.pageCount > 1) {
            //                    var header = document.querySelector('.myTable thead').cloneNode(true);
            //                    var footer = document.querySelector('.myTable tfoot').cloneNode(true);
            //                    document.querySelector('.myTable').deleteTHead();
            //                    document.querySelector('.myTable').deleteTFoot();
            //                    this.table(header, 1, 0);
            //                    this.table(footer, -1, 0);
            //                }
            //            }
            //        }
            //    };
            //    html2pdf().set(options).from(element).save();
            //}
            function exportToPdf() {
                let element = document.querySelector('.container');
                let options = {
                    margin: [0, 0, 0, 0],
                    filename: 'Inventort-report.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: getScaleFactor(element.offsetWidth, element.offsetHeight) },
                    jsPDF: { unit: 'in', format: 'letter', orientation: 'landscape' },
                };
                html2pdf().set(options).from(element).save();
            }


            function getScaleFactor(width, height) {
                const maxWidth = 8.5; // Letter size width in inches
                const maxHeight = 11; // Letter size height in inches
                const widthScale = width / maxWidth;
                const heightScale = height / maxHeight;
                return Math.min(1, Math.min(widthScale, heightScale));
            }
        </script>

        <script>

    let codeToDelete = "";
    window.onload = function () {
        let message = '@Session["added"]';
        let success = localStorage.getItem("removed");
        if (message !== '') {
            saveOpenPopup();
            @{
                Session["added"] = "";
            }
        }
        if (success == "success") {
            remOpenPopup();
            localStorage.setItem("removed", null);
        }
        GetAll();
    }

    // Close the dropdown if the user clicks outside of it
    window.onclick = function (e) {
        if (!e.target.matches('.drop-btn')) {
            var myDropdown = document.getElementById("myDropdown");
            if (myDropdown.classList.contains('show')) {
                myDropdown.classList.remove('show');

            }
        }
    }

    function userSortFunction() {
        document.getElementById("invSortDropdown").classList.toggle("InventoryReport-sort-show");
    }

    let archpopup = document.getElementById("arch-popup");
    function OpenArchPopup() {
        archpopup.classList.add("arch-popup-show")
    }

    function CloseArchPopup() {
        archpopup.classList.remove("arch-popup-show")
    }

    // Close the dropdown if the user clicks outside of it
    window.onclick = function (e) {
        if (!e.target.matches('.InventoryReport-sort-btn')) {
            var myDropdown = document.getElementById("invSortDropdown");
            if (myDropdown.classList.contains('InventoryReport-sort-show')) {
                myDropdown.classList.remove('InventoryReport-sort-show');
            }
        }
    }
    //Messege Box

        </script>

    </main>
</div>

